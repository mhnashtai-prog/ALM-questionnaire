.photo-trigger {
        padding: 12px 20px;
        font-size: 16px;
      }<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>INTUITY - Student Response</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      position: relative;
      background: #000000;
    }

    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(255, 140, 60, 0.45) 0%, transparent 55%),
                  radial-gradient(circle at 70% 80%, rgba(255, 100, 40, 0.35) 0%, transparent 45%),
                  radial-gradient(circle at 20% 70%, rgba(200, 80, 30, 0.25) 0%, transparent 65%),
                  radial-gradient(circle at 90% 10%, rgba(255, 160, 80, 0.2) 0%, transparent 40%),
                  linear-gradient(135deg, #000000 0%, #000000 30%, #0a0503 70%, #000000 100%);
    }

    .curved-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 1;
    }

    .curve {
      position: absolute;
      border-radius: 50%;
      backdrop-filter: blur(2px);
    }

    .curve1 {
      width: 200px;
      height: 400px;
      top: -100px;
      right: -50px;
      transform: rotate(30deg);
      border: 2px solid rgba(255, 140, 60, 0.7);
      background: linear-gradient(45deg, rgba(255, 140, 60, 0.25) 0%, rgba(255, 100, 40, 0.15) 50%, rgba(200, 80, 30, 0.08) 100%);
      box-shadow: inset 0 0 60px rgba(255, 120, 50, 0.2), 0 0 40px rgba(255, 140, 60, 0.15);
      opacity: 0.9;
      animation: float 8s ease-in-out infinite;
    }

    .curve2 {
      width: 150px;
      height: 300px;
      bottom: -80px;
      left: -30px;
      transform: rotate(-20deg);
      border: 1px solid rgba(255, 100, 40, 0.5);
      background: linear-gradient(45deg, rgba(255, 100, 40, 0.18) 0%, rgba(200, 80, 30, 0.12) 50%, transparent 100%);
      box-shadow: inset 0 0 45px rgba(255, 100, 40, 0.15);
      opacity: 0.7;
      animation: float 10s ease-in-out infinite reverse;
    }

    .curve3 {
      width: 120px;
      height: 250px;
      top: 40%;
      right: 10%;
      transform: rotate(60deg);
      border: 1px solid rgba(255, 160, 80, 0.4);
      background: linear-gradient(45deg, rgba(255, 160, 80, 0.12) 0%, rgba(255, 140, 60, 0.06) 50%, transparent 100%);
      box-shadow: inset 0 0 35px rgba(255, 160, 80, 0.1);
      opacity: 0.5;
      animation: drift 6s ease-in-out infinite;
    }

    .curve4 {
      width: 80px;
      height: 160px;
      top: 20%;
      left: 20%;
      transform: rotate(-45deg);
      border: 1px solid rgba(255, 120, 50, 0.3);
      background: linear-gradient(45deg, rgba(255, 120, 50, 0.08) 0%, rgba(200, 80, 30, 0.04) 50%, transparent 100%);
      box-shadow: inset 0 0 25px rgba(255, 120, 50, 0.08);
      opacity: 0.3;
      animation: pulse 12s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(var(--rotation, 0deg)); opacity: var(--base-opacity, 0.5); }
      33% { transform: translateY(-8px) rotate(calc(var(--rotation, 0deg) + 1deg)); opacity: calc(var(--base-opacity, 0.5) * 1.2); }
      66% { transform: translateY(-4px) rotate(calc(var(--rotation, 0deg) - 0.5deg)); opacity: calc(var(--base-opacity, 0.5) * 0.8); }
    }

    @keyframes pulse {
      0%, 100% { opacity: var(--base-opacity, 0.3); transform: scale(1); }
      50% { opacity: calc(var(--base-opacity, 0.3) * 1.5); transform: scale(1.02); }
    }

    @keyframes drift {
      0%, 100% { transform: translateX(0px) translateY(0px) rotate(var(--rotation, 0deg)); }
      25% { transform: translateX(3px) translateY(-5px) rotate(calc(var(--rotation, 0deg) + 1deg)); }
      50% { transform: translateX(-2px) translateY(-8px) rotate(calc(var(--rotation, 0deg) - 0.5deg)); }
      75% { transform: translateX(4px) translateY(-3px) rotate(calc(var(--rotation, 0deg) + 0.8deg)); }
    }

    .curve1 { --base-opacity: 0.9; --rotation: 30deg; }
    .curve2 { --base-opacity: 0.7; --rotation: -20deg; }
    .curve3 { --base-opacity: 0.5; --rotation: 60deg; }
    .curve4 { --base-opacity: 0.3; --rotation: -45deg; }

    .container {
      position: relative;
      z-index: 10;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 60px 20px 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 32px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 8px;
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(255, 140, 60, 0.3);
    }

    .header p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    .main-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 0;
    }

    .response-container {
      width: 100%;
      max-width: 500px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 140, 60, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }

    .question-display {
      font-size: 18px;
      color: #fff;
      margin-bottom: 25px;
      text-align: center;
      line-height: 1.4;
      padding: 20px;
      background: rgba(255, 140, 60, 0.1);
      border-radius: 15px;
      border: 1px solid rgba(255, 140, 60, 0.2);
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .input-field {
      width: 100%;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .input-field:focus {
      border-color: rgba(255, 140, 60, 0.6);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 20px rgba(255, 140, 60, 0.2);
    }

    .input-field::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .textarea-field {
      min-height: 120px;
      resize: vertical;
    }

    .photo-container {
      margin-top: 15px;
      display: flex;
      justify-content: center;
    }

    .photo-trigger {
      background: linear-gradient(45deg, rgba(255, 140, 60, 0.8), rgba(255, 100, 40, 0.8));
      border: 2px solid rgba(255, 140, 60, 0.9);
      border-radius: 15px;
      padding: 15px 25px;
      color: #000;
      cursor: pointer;
      font-size: 18px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 140, 60, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .photo-trigger:hover {
      background: linear-gradient(45deg, rgba(255, 140, 60, 1), rgba(255, 100, 40, 1));
      border-color: rgba(255, 140, 60, 1);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 140, 60, 0.5);
    }

    .photo-trigger.has-photo {
      background: linear-gradient(45deg, rgba(16, 185, 129, 0.8), rgba(5, 150, 105, 0.8));
      border-color: rgba(16, 185, 129, 0.9);
      color: #000;
    }

    .photo-trigger.has-photo:hover {
      background: linear-gradient(45deg, rgba(16, 185, 129, 1), rgba(5, 150, 105, 1));
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
    }

    .word-counter {
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      margin: 15px 0;
    }

    .word-counter.has-words {
      color: rgba(255, 140, 60, 0.8);
    }

    .validation-message {
      display: none;
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
    }

    .validation-message.success {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: rgba(16, 185, 129, 0.9);
      display: block;
    }

    .validation-message.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: rgba(239, 68, 68, 0.9);
      display: block;
    }

    .success-container {
      display: none;
      text-align: center;
      padding: 40px;
      background: rgba(16, 185, 129, 0.1);
      border: 2px solid rgba(16, 185, 129, 0.3);
      border-radius: 20px;
      margin: 20px;
    }

    .success-icon {
      font-size: 48px;
      color: rgba(16, 185, 129, 0.9);
      margin-bottom: 20px;
    }

    .success-title {
      font-size: 24px;
      font-weight: 600;
      color: rgba(16, 185, 129, 0.9);
      margin-bottom: 15px;
    }

    .success-text {
      color: rgba(255, 255, 255, 0.8);
      font-size: 16px;
    }

    .footer {
      background: rgba(64, 64, 64, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      padding: 15px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .footer-button {
      padding: 12px 20px;
      border-radius: 15px;
      border: none;
      background: rgba(255, 255, 255, 0.08);
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      font-weight: 500;
    }

    .footer-button:hover {
      background: rgba(255, 140, 60, 0.2);
      color: #fff;
      transform: translateY(-2px);
    }

    .footer-button.primary {
      background: linear-gradient(45deg, rgba(255, 140, 60, 0.8), rgba(255, 100, 40, 0.8));
      color: #000;
      font-weight: 600;
    }

    .footer-button.primary:hover {
      background: linear-gradient(45deg, rgba(255, 140, 60, 1), rgba(255, 100, 40, 1));
      transform: translateY(-2px) scale(1.05);
    }

    .footer-button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Photo Modal */
    .photo-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .photo-modal.show {
      display: flex;
    }

    .photo-modal-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    .photo-modal img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
    }

    .photo-modal-controls {
      position: absolute;
      top: -50px;
      right: 0;
      display: flex;
      gap: 10px;
    }

    .photo-modal-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .photo-modal-btn:hover {
      background: rgba(255, 140, 60, 0.2);
    }

    /* Camera Preview */
    .camera-preview {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: black;
      z-index: 2000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .camera-preview.show {
      display: flex;
    }

    .camera-preview video {
      max-width: 100%;
      max-height: 70vh;
      border-radius: 12px;
    }

    .camera-controls {
      margin-top: 20px;
      display: flex;
      gap: 15px;
    }

    .camera-btn {
      background: rgba(255, 140, 60, 0.8);
      border: none;
      border-radius: 25px;
      padding: 15px 25px;
      color: #000;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .camera-btn:hover {
      background: rgba(255, 140, 60, 1);
      transform: scale(1.05);
    }

    .camera-btn.secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .camera-btn.secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Mobile Optimizations */
    @media (max-width: 768px) {
      .container {
        padding: 40px 15px 15px;
      }
      
      .header h1 {
        font-size: 28px;
      }
      
      .response-container {
        max-width: 100%;
        padding: 25px;
      }
      
      .footer {
        gap: 10px;
      }
      
      .footer-button {
        padding: 10px 15px;
        font-size: 13px;
      }
      
      .photo-trigger {
        padding: 12px 20px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="curved-overlay">
      <div class="curve curve1"></div>
      <div class="curve curve2"></div>
      <div class="curve curve3"></div>
      <div class="curve curve4"></div>
    </div>
  </div>

  <div class="container">
    <header class="header">
      <h1>INTUITY</h1>
      <p>Intuitive Learning<br>By Majid Nashtai</p>
    </header>

    <main class="main-content">
      <div class="response-container" id="responseContainer">
        <div class="question-display" id="questionDisplay">
          Loading question...
        </div>
        
        <div class="input-group">
          <label class="input-label" for="studentName">Your Name</label>
          <input type="text" class="input-field" id="studentName" placeholder="Enter your name..." maxlength="50">
          <div class="photo-container">
            <div class="photo-trigger" id="photoTrigger">📸 Add Photo</div>
          </div>
        </div>
        
        <div class="input-group">
          <label class="input-label" for="studentAnswer">Your Response</label>
          <textarea class="input-field textarea-field" id="studentAnswer" placeholder="Share your thoughts..." rows="5"></textarea>
          <div class="word-counter" id="wordCounter">0 words</div>
        </div>
        
        <div class="validation-message" id="validationMessage"></div>
      </div>
      
      <div class="success-container" id="successContainer">
        <div class="success-icon">✨</div>
        <div class="success-title">Response Submitted!</div>
        <div class="success-text">Thank you! Your response has been saved successfully.</div>
      </div>
    </main>

    <footer class="footer">
      <button class="footer-button" id="clearBtn">Clear</button>
      <button class="footer-button" id="editBtn">Edit</button>
      <button class="footer-button primary" id="submitBtn" disabled>Submit</button>
    </footer>
  </div>

  <!-- Photo Modal -->
  <div class="photo-modal" id="photoModal">
    <div class="photo-modal-content">
      <div class="photo-modal-controls">
        <button class="photo-modal-btn" id="retakeBtn" title="Retake">📷</button>
        <button class="photo-modal-btn" id="removePhotoBtn" title="Remove">🗑️</button>
        <button class="photo-modal-btn" id="closeModalBtn" title="Close">✕</button>
      </div>
      <img id="photoModalImg" />
    </div>
  </div>

  <!-- Camera Preview -->
  <div class="camera-preview" id="cameraPreview">
    <video id="cameraVideo" autoplay muted playsinline></video>
    <div class="camera-controls">
      <button class="camera-btn" id="captureBtn">Capture</button>
      <button class="camera-btn secondary" id="cancelCameraBtn">Cancel</button>
    </div>
  </div>

  <!-- Hidden file input -->
  <input type="file" id="fileInput" accept="image/*" style="display: none;">

  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://hpdebohqsvjlxeapzkrr.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhwZGVib2hxc3ZqbHhlYXB6a3JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NzkxMTEsImV4cCI6MjA3MzQ1NTExMX0.mnOtWgJaxNDcroSYJSiPxqov47KY3KXOeeltSUL3adw';

    // Global variables
    let supabase;
    let currentQuestion = null;
    let currentPhoto = null;
    let cameraStream = null;
    let wordCount = 0;
    let isSubmitted = false;

    // Initialize Supabase
    function initSupabase() {
      try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('✅ Supabase client initialized');
        return true;
      } catch (error) {
        console.error('❌ Error initializing Supabase:', error);
        return false;
      }
    }

    // Load question
    async function loadQuestion() {
      console.log('🔍 Loading question...');
      
      try {
        // Check URL parameters first
        const urlParams = new URLSearchParams(window.location.search);
        const questionId = urlParams.get('q');
        const questionText = urlParams.get('t');
        
        if (questionText) {
          currentQuestion = {
            id: questionId || Date.now(),
            text: decodeURIComponent(questionText),
            source: 'url'
          };
          displayQuestion();
          return;
        }
        
        // Try to get from Supabase
        if (supabase) {
          const { data, error } = await supabase
            .from('questions')
            .select('*')
            .eq('is_published', true)
            .order('published_at', { ascending: false })
            .limit(1);

          if (!error && data && data[0]) {
            currentQuestion = data[0];
            displayQuestion();
            return;
          }
        }
        
        // Fallback
        showNoQuestion();
        
      } catch (error) {
        console.error('❌ Error loading question:', error);
        showNoQuestion();
      }
    }

    // Display question
    function displayQuestion() {
      const questionDisplay = document.getElementById('questionDisplay');
      if (currentQuestion && currentQuestion.text) {
        questionDisplay.textContent = currentQuestion.text;
      } else {
        showNoQuestion();
      }
    }

    // Show no question state
    function showNoQuestion() {
      const questionDisplay = document.getElementById('questionDisplay');
      questionDisplay.textContent = 'Demo Mode: What would you like to learn today?';
      questionDisplay.style.background = 'rgba(59, 130, 246, 0.1)';
      questionDisplay.style.borderColor = 'rgba(59, 130, 246, 0.2)';
    }

    // Handle input changes
    function handleInput() {
      const nameInput = document.getElementById('studentName');
      const answerInput = document.getElementById('studentAnswer');
      const submitBtn = document.getElementById('submitBtn');
      const validationMessage = document.getElementById('validationMessage');
      
      const name = nameInput.value.trim();
      const answer = answerInput.value.trim();
      
      // Count words
      const words = answer ? answer.split(/\s+/).filter(word => word.length > 0) : [];
      wordCount = words.length;
      updateWordCounter();
      
      // Validation
      if (name && wordCount > 0) {
        submitBtn.disabled = false;
        validationMessage.textContent = 'Ready to submit!';
        validationMessage.className = 'validation-message success';
      } else {
        submitBtn.disabled = true;
        if (!name && wordCount === 0) {
          validationMessage.style.display = 'none';
        } else if (!name) {
          validationMessage.textContent = 'Please enter your name';
          validationMessage.className = 'validation-message error';
        } else {
          validationMessage.textContent = 'Please write your response';
          validationMessage.className = 'validation-message error';
        }
      }
    }

    // Update word counter
    function updateWordCounter() {
      const wordCounter = document.getElementById('wordCounter');
      
      if (wordCount === 0) {
        wordCounter.textContent = 'No words yet';
        wordCounter.classList.remove('has-words');
      } else {
        wordCounter.textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
        wordCounter.classList.add('has-words');
      }
    }

    // Photo functions
    function handlePhotoTrigger() {
      if (currentPhoto) {
        showPhotoModal();
      } else {
        startCamera();
      }
    }

    async function startCamera() {
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'user' } 
        });
        
        const video = document.getElementById('cameraVideo');
        video.srcObject = cameraStream;
        document.getElementById('cameraPreview').classList.add('show');
        
      } catch (error) {
        console.log('Camera not available, using file upload');
        triggerFileUpload();
      }
    }

    function capturePhoto() {
      const video = document.getElementById('cameraVideo');
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      
      canvas.toBlob((blob) => {
        setPhoto(blob);
        stopCamera();
      }, 'image/jpeg', 0.8);
    }

    function stopCamera() {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
      }
      document.getElementById('cameraPreview').classList.remove('show');
    }

    function triggerFileUpload() {
      const fileInput = document.getElementById('fileInput');
      fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file) setPhoto(file);
      };
      fileInput.click();
    }

    function setPhoto(photoBlob) {
      currentPhoto = photoBlob;
      const trigger = document.getElementById('photoTrigger');
      trigger.textContent = '✨ Photo Added';
      trigger.classList.add('has-photo');
    }

    function showPhotoModal() {
      if (!currentPhoto) return;
      
      const modal = document.getElementById('photoModal');
      const modalImg = document.getElementById('photoModalImg');
      
      modalImg.src = URL.createObjectURL(currentPhoto);
      modal.classList.add('show');
    }

    function removePhoto() {
      currentPhoto = null;
      const trigger = document.getElementById('photoTrigger');
      trigger.textContent = '📸 Add Photo';
      trigger.classList.remove('has-photo');
      document.getElementById('photoModal').classList.remove('show');
    }

    // Submit response
    async function submitResponse() {
      if (isSubmitted) return;
      
      const nameInput = document.getElementById('studentName');
      const answerInput = document.getElementById('studentAnswer');
      const submitBtn = document.getElementById('submitBtn');
      
      const studentName = nameInput.value.trim();
      const studentAnswer = answerInput.value.trim();
      
      if (!studentName || wordCount === 0) {
        alert('Please complete all fields.');
        return;
      }

      // Show loading
      const originalContent = submitBtn.textContent;
      submitBtn.innerHTML = '⏳ Submitting...';
      submitBtn.disabled = true;

      try {
        let photoUrl = null;
        
        // Upload photo if exists
        if (currentPhoto && supabase) {
          const fileName = `student-photos/${Date.now()}.jpg`;
          const { data, error } = await supabase.storage
            .from('student-responses')
            .upload(fileName, currentPhoto);

          if (!error) {
            const { data: urlData } = supabase.storage
              .from('student-responses')
              .getPublicUrl(fileName);
            photoUrl = urlData.publicUrl;
          }
        }

        // Create response object
        const response = {
          questionId: currentQuestion?.id || 'demo',
          questionText: currentQuestion?.text || 'Demo Question',
          studentName: studentName,
          answer: studentAnswer,
          wordCount: wordCount,
          timestamp: new Date().toISOString(),
          photoUrl: photoUrl
        };

        // Submit to Supabase if available
        if (supabase && currentQuestion?.id !== 'demo') {
          await supabase.from('student_responses').insert([{
            question_id: response.questionId,
            student_name: response.studentName,
            answer: response.answer,
            word_count: response.wordCount,
            photo_url: response.photoUrl, // Store photo URL directly 
            metadata: {
              timestamp: response.timestamp,
              photo_url: response.photoUrl // Also in metadata for backup
            }
          }]);
        }

        // Show success
        showSuccess();
        isSubmitted = true;
        
      } catch (error) {
        console.error('❌ Error submitting response:', error);
        alert('Response saved! It will be submitted when connection is restored.');
        showSuccess();
        isSubmitted = true;
      }
    }

    // Show success state
    function showSuccess() {
      document.getElementById('responseContainer').style.display = 'none';
      document.getElementById('successContainer').style.display = 'block';
      
      const clearBtn = document.getElementById('clearBtn');
      clearBtn.textContent = 'Done';
      clearBtn.onclick = () => window.location.reload();
      
      document.getElementById('editBtn').style.display = 'none';
      document.getElementById('submitBtn').style.display = 'none';
    }

    // Clear form
    function clearForm() {
      if (isSubmitted) {
        window.location.reload();
        return;
      }
      
      if (confirm('Clear your response?')) {
        document.getElementById('studentName').value = '';
        document.getElementById('studentAnswer').value = '';
        wordCount = 0;
        updateWordCounter();
        removePhoto();
        handleInput();
      }
    }

    // Focus on answer
    function focusOnAnswer() {
      document.getElementById('studentAnswer').focus();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('🚀 INTUITY Student Interface initializing...');
      
      // Initialize Supabase
      initSupabase();
      
      // Load question
      await loadQuestion();
      
      // Set up event listeners
      document.getElementById('studentName').addEventListener('input', handleInput);
      document.getElementById('studentAnswer').addEventListener('input', handleInput);
      document.getElementById('submitBtn').addEventListener('click', submitResponse);
      document.getElementById('clearBtn').addEventListener('click', clearForm);
      document.getElementById('editBtn').addEventListener('click', focusOnAnswer);
      
      // Photo event listeners
      document.getElementById('photoTrigger').addEventListener('click', handlePhotoTrigger);
      document.getElementById('captureBtn').addEventListener('click', capturePhoto);
      document.getElementById('cancelCameraBtn').addEventListener('click', stopCamera);
      document.getElementById('retakeBtn').addEventListener('click', () => {
        document.getElementById('photoModal').classList.remove('show');
        startCamera();
      });
      document.getElementById('removePhotoBtn').addEventListener('click', removePhoto);
      document.getElementById('closeModalBtn').addEventListener('click', () => {
        document.getElementById('photoModal').classList.remove('show');
      });
      
      // Modal click outside to close
      document.getElementById('photoModal').addEventListener('click', (e) => {
        if (e.target.id === 'photoModal') {
          document.getElementById('photoModal').classList.remove('show');
        }
      });
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          const submitBtn = document.getElementById('submitBtn');
          if (!submitBtn.disabled) submitResponse();
        }
        if (e.key === 'Escape' && !isSubmitted) clearForm();
      });
      
      console.log('✅ Student interface ready!');
    });
  </script>
</body>
</html>
