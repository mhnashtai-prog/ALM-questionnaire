<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALM - Speech Bubble Analytics</title>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800&family=SF+Pro+Text:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      /* iPhone 15 Pro Color Palette */
      --bg-primary: #000000;
      --bg-secondary: #1c1c1e;
      --bg-tertiary: #2c2c2e;
      --bg-quaternary: #3a3a3c;
      
      /* Glassmorphic Elements */
      --glass-primary: rgba(255, 255, 255, 0.08);
      --glass-secondary: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.12);
      --glass-strong: rgba(255, 255, 255, 0.15);
      
      /* iPhone 15 Accent Colors */
      --accent-blue: #007AFF;
      --accent-green: #30D158;
      --accent-orange: #FF9F0A;
      --accent-red: #FF453A;
      --accent-purple: #BF5AF2;
      --accent-pink: #FF2D92;
      --accent-teal: #64D2FF;
      --accent-indigo: #5E5CE6;
      
      /* Text Colors */
      --text-primary: #FFFFFF;
      --text-secondary: rgba(255, 255, 255, 0.6);
      --text-tertiary: rgba(255, 255, 255, 0.4);
      --text-quaternary: rgba(255, 255, 255, 0.25);
      
      /* Dynamic Island Inspired */
      --dynamic-island: rgba(0, 0, 0, 0.95);
      --dynamic-border: rgba(255, 255, 255, 0.08);
      
      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-xxl: 48px;
      
      /* Effects */
      --blur-light: blur(20px);
      --blur-heavy: blur(40px);
      --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-strong: 0 16px 64px rgba(0, 0, 0, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* Ambient Background Elements */
    .ambient-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .ambient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.15;
      animation: float 20s ease-in-out infinite;
    }

    .orb-1 {
      width: 400px;
      height: 400px;
      background: var(--accent-blue);
      top: 10%;
      left: 20%;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 300px;
      height: 300px;
      background: var(--accent-purple);
      top: 60%;
      right: 20%;
      animation-delay: 7s;
    }

    .orb-3 {
      width: 200px;
      height: 200px;
      background: var(--accent-teal);
      bottom: 20%;
      left: 60%;
      animation-delay: 14s;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -30px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
    }

    /* Dynamic Island Header */
    .dynamic-header {
      position: fixed;
      top: var(--space-lg);
      left: 50%;
      transform: translateX(-50%);
      background: var(--dynamic-island);
      backdrop-filter: var(--blur-heavy);
      border: 1px solid var(--dynamic-border);
      border-radius: 32px;
      padding: var(--space-md) var(--space-xl);
      z-index: 100;
      display: flex;
      align-items: center;
      gap: var(--space-md);
      box-shadow: var(--shadow-strong);
    }

    .question-indicator {
      background: var(--accent-blue);
      color: white;
      font-weight: 700;
      font-size: 0.875rem;
      padding: var(--space-xs) var(--space-sm);
      border-radius: 12px;
      min-width: 48px;
      text-align: center;
      letter-spacing: 0.5px;
    }

    .question-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
      max-width: 600px;
      text-align: center;
      line-height: 1.4;
    }

    .response-count {
      background: var(--glass-primary);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: var(--space-xs) var(--space-sm);
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    /* Control Panel */
    .control-panel {
      position: fixed;
      bottom: var(--space-lg);
      left: 50%;
      transform: translateX(-50%);
      background: var(--glass-primary);
      backdrop-filter: var(--blur-light);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: var(--space-sm);
      z-index: 100;
      display: flex;
      gap: var(--space-sm);
      box-shadow: var(--shadow-soft);
    }

    .control-btn {
      background: var(--glass-secondary);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: var(--space-sm) var(--space-md);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      text-decoration: none;
      white-space: nowrap;
    }

    .control-btn:hover {
      background: var(--glass-strong);
      border-color: var(--accent-blue);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
    }

    .control-btn.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    /* Question Selector */
    .question-selector {
      background: var(--glass-primary);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: var(--space-sm) var(--space-md);
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
    }

    /* Speech Bubbles Container */
    .speech-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      padding: 120px var(--space-lg) 120px;
    }

    .speech-bubble {
      position: absolute;
      background: var(--glass-primary);
      backdrop-filter: var(--blur-light);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: var(--space-lg);
      max-width: 320px;
      min-width: 280px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: var(--shadow-soft);
      animation: speechFloat 8s ease-in-out infinite;
    }

    .speech-bubble::before {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border-style: solid;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    /* Speech bubble tail variants */
    .speech-bubble.tail-left::before {
      bottom: 30px;
      left: -12px;
      border-width: 12px 12px 12px 0;
      border-color: transparent var(--glass-border) transparent transparent;
    }

    .speech-bubble.tail-right::before {
      bottom: 30px;
      right: -12px;
      border-width: 12px 0 12px 12px;
      border-color: transparent transparent transparent var(--glass-border);
    }

    .speech-bubble.tail-bottom::before {
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 12px 12px 0 12px;
      border-color: var(--glass-border) transparent transparent transparent;
    }

    .speech-bubble:hover {
      transform: translateY(-8px) scale(1.02);
      background: var(--glass-strong);
      border-color: var(--accent-blue);
      box-shadow: 0 20px 60px rgba(0, 122, 255, 0.2);
    }

    .speech-bubble.selected {
      background: var(--glass-strong);
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.3);
    }

    /* Quality-based styling */
    .speech-bubble.excellent {
      border-color: var(--accent-green);
      background: linear-gradient(135deg, var(--glass-primary), rgba(48, 209, 88, 0.05));
    }

    .speech-bubble.excellent:hover {
      border-color: var(--accent-green);
      box-shadow: 0 20px 60px rgba(48, 209, 88, 0.3);
    }

    .speech-bubble.good {
      border-color: var(--accent-orange);
      background: linear-gradient(135deg, var(--glass-primary), rgba(255, 159, 10, 0.05));
    }

    .speech-bubble.good:hover {
      border-color: var(--accent-orange);
      box-shadow: 0 20px 60px rgba(255, 159, 10, 0.3);
    }

    .speech-bubble.needs-work {
      border-color: var(--accent-red);
      background: linear-gradient(135deg, var(--glass-primary), rgba(255, 69, 58, 0.05));
    }

    .speech-bubble.needs-work:hover {
      border-color: var(--accent-red);
      box-shadow: 0 20px 60px rgba(255, 69, 58, 0.3);
    }

    @keyframes speechFloat {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(10px, -15px) rotate(0.5deg); }
      50% { transform: translate(-5px, -25px) rotate(-0.3deg); }
      75% { transform: translate(-10px, -15px) rotate(0.2deg); }
    }

    /* Student Avatar */
    .student-avatar {
      width: 44px;
      height: 44px;
      border-radius: 22px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: var(--space-md);
      border: 2px solid var(--glass-border);
    }

    .student-name {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }

    .speech-content {
      font-family: 'SF Pro Text', system-ui, sans-serif;
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text-secondary);
      margin-bottom: var(--space-md);
      display: -webkit-box;
      -webkit-line-clamp: 4;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .speech-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: var(--space-sm);
      border-top: 1px solid var(--glass-border);
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: 0.75rem;
      color: var(--text-tertiary);
      font-weight: 500;
    }

    .quality-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .excellent .quality-indicator {
      background: var(--accent-green);
      box-shadow: 0 0 8px rgba(48, 209, 88, 0.5);
    }

    .good .quality-indicator {
      background: var(--accent-orange);
      box-shadow: 0 0 8px rgba(255, 159, 10, 0.5);
    }

    .needs-work .quality-indicator {
      background: var(--accent-red);
      box-shadow: 0 0 8px rgba(255, 69, 58, 0.5);
    }

    /* Detail Panel */
    .detail-panel {
      position: fixed;
      right: -450px;
      top: 0;
      bottom: 0;
      width: 450px;
      background: var(--dynamic-island);
      backdrop-filter: var(--blur-heavy);
      border-left: 1px solid var(--dynamic-border);
      padding: var(--space-xxl);
      overflow-y: auto;
      transition: right 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 200;
    }

    .detail-panel.open {
      right: 0;
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xl);
    }

    .detail-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .close-btn {
      background: var(--glass-primary);
      border: 1px solid var(--glass-border);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      background: var(--accent-red);
      color: white;
      border-color: var(--accent-red);
    }

    .detail-content {
      font-family: 'SF Pro Text', system-ui, sans-serif;
      font-size: 1rem;
      line-height: 1.6;
      color: var(--text-secondary);
      margin-bottom: var(--space-xl);
    }

    .detail-stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .detail-stat {
      background: var(--glass-primary);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: var(--space-md);
      text-align: center;
    }

    .detail-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-xs);
    }

    .detail-stat-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Legend */
    .legend {
      position: fixed;
      top: 50%;
      left: var(--space-lg);
      transform: translateY(-50%);
      background: var(--glass-primary);
      backdrop-filter: var(--blur-light);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: var(--space-md);
      z-index: 90;
    }

    .legend-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-xs);
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .detail-panel {
        width: 100%;
        right: -100%;
      }
      
      .dynamic-header {
        flex-direction: column;
        gap: var(--space-sm);
        padding: var(--space-md);
      }
      
      .question-title {
        font-size: 1rem;
        max-width: 300px;
      }
      
      .speech-bubble {
        max-width: 280px;
        min-width: 240px;
      }
      
      .legend {
        position: fixed;
        bottom: 140px;
        left: var(--space-md);
        top: auto;
        transform: none;
      }
    }

    @media (max-width: 480px) {
      .control-panel {
        flex-wrap: wrap;
        justify-content: center;
        max-width: 90%;
      }
      
      .speech-bubble {
        max-width: 260px;
        min-width: 220px;
        padding: var(--space-md);
      }
    }
  </style>
</head>
<body>
  <div class="ambient-bg">
    <div class="ambient-orb orb-1"></div>
    <div class="ambient-orb orb-2"></div>
    <div class="ambient-orb orb-3"></div>
  </div>

  <header class="dynamic-header">
    <div class="question-indicator" id="question-indicator">Q1</div>
    <div class="question-title" id="question-title">
      How has digital technology transformed modern education?
    </div>
    <div class="response-count" id="response-count">6 responses</div>
  </header>

  <div class="speech-container" id="speech-container">
    <!-- Speech bubbles will be generated here -->
  </div>

  <div class="control-panel">
    <select class="question-selector" id="question-selector" onchange="switchQuestion()">
      <option value="1">Question 1: Digital Technology Impact</option>
      <option value="2">Question 2: Online vs Traditional Learning</option>
      <option value="3">Question 3: Language Learning Strategies</option>
      <option value="4">Question 4: Cultural Understanding</option>
      <option value="5">Question 5: Motivation in Language Learning</option>
      <option value="6">Question 6: Assessment Methods</option>
    </select>
    
    <a href="../teachers/questions/" class="control-btn">
      <i class="fas fa-chalkboard-teacher"></i>
      Teacher
    </a>
    
    <a href="../students/answers/" class="control-btn">
      <i class="fas fa-user-graduate"></i>
      Student
    </a>
    
    <button class="control-btn active" onclick="refreshBubbles()">
      <i class="fas fa-refresh"></i>
      Refresh
    </button>
    
    <button class="control-btn" onclick="exportData()">
      <i class="fas fa-download"></i>
      Export
    </button>
  </div>

  <div class="legend">
    <div class="legend-title">Quality</div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--accent-green);"></div>
      <span>Excellent</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--accent-orange);"></div>
      <span>Good</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--accent-red);"></div>
      <span>Needs Work</span>
    </div>
  </div>

  <div class="detail-panel" id="detail-panel">
    <div class="detail-header">
      <div class="detail-title" id="detail-title">Student Response</div>
      <button class="close-btn" onclick="closeDetail()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="detail-body">
      <!-- Dynamic content will be inserted here -->
    </div>
  </div>

  <script>
    const questionsData = {
      1: {
        text: "How has digital technology transformed modern education?",
        responses: [
          {
            id: 1,
            student: "Maria Rodriguez",
            avatar: "MR",
            answer: "Digital technology has fundamentally transformed modern education by providing interactive learning platforms, enabling distance learning, and creating personalized educational experiences that adapt to individual student needs and learning paces. The integration of AI-powered tutoring systems has revolutionized how we learn.",
            wordCount: 42,
            keywords: ["technology", "digital", "education", "learning"],
            timestamp: "2 hours ago",
            score: 95
          },
          {
            id: 2,
            student: "Ahmed Hassan",
            avatar: "AH",
            answer: "Technology revolutionizes classroom experiences through multimedia content, collaborative projects, and real-time feedback systems that enhance student engagement and comprehension.",
            wordCount: 23,
            keywords: ["technology", "digital"],
            timestamp: "1 hour ago",
            score: 78
          },
          {
            id: 3,
            student: "Sophie Chen",
            avatar: "SC",
            answer: "The digital transformation of education has created unprecedented opportunities for personalized learning experiences. Advanced educational technologies now allow teachers to track student progress in real-time and provide immediate feedback.",
            wordCount: 32,
            keywords: ["digital", "education", "learning", "technology"],
            timestamp: "30 minutes ago",
            score: 92
          },
          {
            id: 4,
            student: "Carlos Rivera",
            avatar: "CR",
            answer: "Digital platforms have changed how we learn by making education more interactive and accessible. Students can now learn at their own pace.",
            wordCount: 22,
            keywords: ["digital", "education"],
            timestamp: "45 minutes ago",
            score: 65
          },
          {
            id: 5,
            student: "Aisha Patel",
            avatar: "AP",
            answer: "Technology in education has transformed traditional teaching methods by introducing innovative digital tools that enhance learning outcomes and create dynamic learning environments.",
            wordCount: 24,
            keywords: ["technology", "education", "digital", "learning"],
            timestamp: "20 minutes ago",
            score: 88
          },
          {
            id: 6,
            student: "Marcus Johnson",
            avatar: "MJ",
            answer: "Educational technology has revolutionized how knowledge is delivered and consumed in modern classrooms through virtual reality and AI-powered systems.",
            wordCount: 21,
            keywords: ["technology", "education", "digital"],
            timestamp: "10 minutes ago",
            score: 85
          }
        ]
      }
    };

    let currentQuestion = 1;
    let selectedBubble = null;

    function generateSpeechBubbles() {
      const container = document.getElementById('speech-container');
      const questionData = questionsData[currentQuestion];
      
      if (!questionData) return;
      
      // Clear existing bubbles
      container.innerHTML = '';
      
      // Update header
      document.getElementById('question-indicator').textContent = `Q${currentQuestion}`;
      document.getElementById('question-title').textContent = questionData.text;
      document.getElementById('response-count').textContent = `${questionData.responses.length} responses`;
      
      const containerRect = container.getBoundingClientRect();
      const bubbleWidth = 300;
      const bubbleHeight = 200;
      const margin = 40;
      
      questionData.responses.forEach((response, index) => {
        const bubble = document.createElement('div');
        bubble.className = 'speech-bubble';
        
        // Add quality class
        if (response.score >= 85) {
          bubble.classList.add('excellent');
        } else if (response.score >= 70) {
          bubble.classList.add('good');
        } else {
          bubble.classList.add('needs-work');
        }
        
        // Add random tail direction
        const tailDirections = ['tail-left', 'tail-right', 'tail-bottom'];
        bubble.classList.add(tailDirections[index % 3]);
        
        // Position bubbles in organic layout
        const cols = Math.ceil(Math.sqrt(questionData.responses.length));
        const rows = Math.ceil(questionData.responses.length / cols);
        
        const colIndex = index % cols;
        const rowIndex = Math.floor(index / cols);
        
        const baseX = (containerRect.width / cols) * colIndex + (containerRect.width / cols - bubbleWidth) / 2;
        const baseY = (containerRect.height / rows) * rowIndex + (containerRect.height / rows - bubbleHeight) / 2;
        
        // Add some randomness for organic feel
        const randomX = (Math.random() - 0.5) * 100;
        const randomY = (Math.random() - 0.5) * 80;
        
        bubble.style.left = Math.max(margin, Math.min(containerRect.width - bubbleWidth - margin, baseX + randomX)) + 'px';
        bubble.style.top = Math.max(margin, Math.min(containerRect.height - bubbleHeight - margin, baseY + randomY)) + 'px';
        bubble.style.animationDelay = (index * 0.3) + 's';
        
        // Generate avatar colors
        const avatarColors = [
          'linear-gradient(135deg, var(--accent-blue), var(--accent-purple))',
          'linear-gradient(135deg, var(--accent-green), var(--accent-teal))',
          'linear-gradient(135deg, var(--accent-orange), var(--accent-pink))',
          'linear-gradient(135deg, var(--accent-red), var(--accent-purple))',
          'linear-gradient(135deg, var(--accent-indigo), var(--accent-blue))',
          'linear-gradient(135deg, var(--accent-teal), var(--accent-green))'
        ];
        
        bubble.innerHTML = `
          <div class="student-avatar" style="background: ${avatarColors[index % avatarColors.length]}">
            ${response.avatar}
          </div>
          <div class="student-name">${response.student}</div>
          <div class="speech-content">${response.answer}</div>
          <div class="speech-stats">
            <div class="stat-item">
              <div class="quality-indicator"></div>
              <span>${response.score}%</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-font"></i>
              <span>${response.wordCount}</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-key"></i>
              <span>${response.keywords.length}/4</span>
            </div>
          </div>
        `;
        
        bubble.addEventListener('click', () => showDetail(response));
        container.appendChild(bubble);
      });
    }

    function showDetail(response) {
      const panel = document.getElementById('detail-panel');
      const title = document.getElementById('detail-title');
      const body = document.getElementById('detail-body');
      
      title.textContent = response.student;
      
      body.innerHTML = `
        <div class="detail-stats-grid">
          <div class="detail-stat">
            <div class="detail-stat-value" style="color: var(--accent-green);">${response.score}%</div>
            <div class="detail-stat-label">Quality Score</div>
          </div>
          <div class="detail-stat">
            <div class="detail-stat-value" style="color: var(--accent-blue);">${response.wordCount}</div>
            <div class="detail-stat-label">Word Count</div>
          </div>
          <div class="detail-stat">
            <div class="detail-stat-value" style="color: var(--accent-purple);">${response.keywords.length}/4</div>
            <div class="detail-stat-label">Keywords</div>
          </div>
          <div class="detail-stat">
            <div class="detail-stat-value" style="color: var(--accent-orange);">${response.timestamp}</div>
            <div class="detail-stat-label">Submitted</div>
          </div>
        </div>
        
        <div class="detail-content">
          <h4 style="color: var(--text-primary); margin-bottom: var(--space-md); font-size: 1.125rem;">Full Response:</h4>
          <p>${response.answer}</p>
        </div>
        
        <div style="display: flex; gap: var(--space-md);">
          <button class="control-btn" onclick="highlightKeywords(${response.id})">
            <i class="fas fa-highlighter"></i>
            Highlight
          </button>
          <button class="control-btn" onclick="startDiscussion(${response.id})">
            <i class="fas fa-comments"></i>
            Discuss
          </button>
        </div>
      `;
      
      panel.classList.add('open');
      
      // Highlight selected bubble
      document.querySelectorAll('.speech-bubble').forEach(bubble => bubble.classList.remove('selected'));
      selectedBubble = response.id;
    }

    function closeDetail() {
      document.getElementById('detail-panel').classList.remove('open');
      document.querySelectorAll('.speech-bubble').forEach(bubble => bubble.classList.remove('selected'));
      selectedBubble = null;
    }

    function switchQuestion() {
      currentQuestion = parseInt(document.getElementById('question-selector').value);
      generateSpeechBubbles();
      closeDetail();
    }

    function refreshBubbles() {
      generateSpeechBubbles();
      
      // Refresh animation
      const bubbles = document.querySelectorAll('.speech-bubble');
      bubbles.forEach((bubble, index) => {
        bubble.style.animation = 'none';
        bubble.offsetHeight; // Trigger reflow
        bubble.style.animation = `speechFloat ${8 + Math.random() * 2}s ease-in-out infinite`;
        bubble.style.animationDelay = (index * 0.3) + 's';
      });
    }

    function exportData() {
      alert('ðŸ“Š Export functionality ready! Would integrate with CSV/Excel export in production.');
    }

    function highlightKeywords(responseId) {
      alert('ðŸ” Keyword highlighting activated! This would highlight required keywords in the student response.');
    }

    function startDiscussion(responseId) {
      alert('ðŸ’¬ Discussion Mode Started!\n\nThis would open a collaborative discussion interface for this specific response.');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      generateSpeechBubbles();
      
      // Auto-refresh bubbles periodically for dynamic effect
      setInterval(() => {
        if (!selectedBubble) {
          refreshBubbles();
        }
      }, 12000);
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      setTimeout(generateSpeechBubbles, 100);
    });
  </script>
</body>
</html>
