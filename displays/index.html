<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTUITY - Live Responses (Full Display)</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      position: relative;
      background: #000000;
    }

    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 20%, rgba(255, 140, 60, 0.45) 0%, transparent 55%),
                  radial-gradient(circle at 70% 80%, rgba(255, 100, 40, 0.35) 0%, transparent 45%),
                  radial-gradient(circle at 20% 70%, rgba(200, 80, 30, 0.25) 0%, transparent 65%),
                  radial-gradient(circle at 90% 10%, rgba(255, 160, 80, 0.2) 0%, transparent 40%),
                  linear-gradient(135deg, #000000 0%, #000000 30%, #0a0503 70%, #000000 100%);
    }

    .curved-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 1;
      pointer-events: none;
    }

    .curve {
      position: absolute;
      border-radius: 50%;
      backdrop-filter: blur(2px);
    }

    .curve1 {
      width: 200px;
      height: 400px;
      top: -100px;
      right: -50px;
      transform: rotate(8deg);
      border: 1px solid rgba(255, 140, 60, 0.3);
      background: linear-gradient(45deg, rgba(255, 140, 60, 0.12) 0%, rgba(255, 100, 40, 0.08) 50%, rgba(200, 80, 30, 0.04) 100%);
      box-shadow: inset 0 0 30px rgba(255, 120, 50, 0.08);
      opacity: 0.4;
    }

    .curve2 {
      width: 150px;
      height: 300px;
      bottom: -80px;
      left: -30px;
      transform: rotate(-5deg);
      border: 1px solid rgba(255, 100, 40, 0.2);
      background: linear-gradient(45deg, rgba(255, 100, 40, 0.08) 0%, rgba(200, 80, 30, 0.06) 50%, transparent 100%);
      box-shadow: inset 0 0 20px rgba(255, 100, 40, 0.06);
      opacity: 0.3;
    }

    .curve3 {
      width: 120px;
      height: 250px;
      top: 40%;
      right: 10%;
      transform: rotate(12deg);
      border: 1px solid rgba(255, 160, 80, 0.2);
      background: linear-gradient(45deg, rgba(255, 160, 80, 0.06) 0%, rgba(255, 140, 60, 0.03) 50%, transparent 100%);
      box-shadow: inset 0 0 15px rgba(255, 160, 80, 0.05);
      opacity: 0.25;
    }

    .curve4 {
      width: 80px;
      height: 160px;
      top: 20%;
      left: 20%;
      transform: rotate(-10deg);
      border: 1px solid rgba(255, 120, 50, 0.15);
      background: linear-gradient(45deg, rgba(255, 120, 50, 0.04) 0%, rgba(200, 80, 30, 0.02) 50%, transparent 100%);
      box-shadow: inset 0 0 12px rgba(255, 120, 50, 0.04);
      opacity: 0.2;
    }

    .curve5 {
      width: 180px;
      height: 360px;
      bottom: 10%;
      right: 15%;
      transform: rotate(6deg);
      border: 1px solid rgba(255, 140, 60, 0.25);
      background: linear-gradient(45deg, rgba(255, 140, 60, 0.08) 0%, rgba(255, 100, 40, 0.05) 50%, rgba(200, 80, 30, 0.03) 100%);
      box-shadow: inset 0 0 25px rgba(255, 140, 60, 0.08);
      opacity: 0.35;
    }

    .curve6 {
      width: 60px;
      height: 120px;
      top: 65%;
      left: 8%;
      transform: rotate(-15deg);
      border: 1px solid rgba(255, 160, 80, 0.1);
      background: linear-gradient(45deg, rgba(255, 160, 80, 0.03) 0%, transparent 100%);
      opacity: 0.15;
    }

    .container {
      position: relative;
      z-index: 10;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 40px 20px 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 32px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 8px;
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(255, 140, 60, 0.3);
    }

    .header p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    .question-display {
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      margin-bottom: 30px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(255, 140, 60, 0.2);
      backdrop-filter: blur(10px);
    }

    .question-content {
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 12px;
    }

    .question-text {
      font-size: 20px;
      color: #fff;
      font-weight: 600;
      line-height: 1.4;
      max-width: 800px;
    }

    .total-count {
      font-size: 14px;
      color: rgba(255, 140, 60, 0.8);
      font-weight: 500;
    }

    /* FULL RESPONSE DISPLAY - POSTER STYLE */
    .response-container {
      width: 100%;
      min-height: 70vh;
      position: relative;
      margin-bottom: 30px;
    }

    .response-card {
      width: 100%;
      min-height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transform: translateX(50px);
      transition: all 0.5s ease;
      pointer-events: none;
    }

    .response-card.active {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
    }

    /* POSTER LAYOUT */
    .response-poster {
      width: 100%;
      min-height: 100%;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 25px;
      border: 1px solid rgba(255, 140, 60, 0.3);
      backdrop-filter: blur(15px);
      padding: 40px;
      display: flex;
      flex-direction: column;
      gap: 30px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .response-poster:hover {
      border-color: rgba(255, 140, 60, 0.5);
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(255, 140, 60, 0.1);
    }

    /* STUDENT HEADER */
    .student-header {
      display: flex;
      align-items: center;
      gap: 20px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(255, 140, 60, 0.2);
    }

    .student-photo-large {
      width: 80px;
      height: 80px;
      border-radius: 15px;
      object-fit: cover;
      border: 3px solid rgba(255, 140, 60, 0.4);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      flex-shrink: 0;
    }

    .student-info-large {
      flex: 1;
    }

    .student-name-large {
      font-size: 28px;
      font-weight: 700;
      color: rgba(255, 140, 60, 0.9);
      margin-bottom: 8px;
      text-shadow: 0 2px 10px rgba(255, 140, 60, 0.2);
    }

    .student-meta {
      display: flex;
      gap: 20px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
    }

    .response-number {
      background: rgba(255, 140, 60, 0.2);
      color: rgba(255, 140, 60, 1);
      padding: 4px 12px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* MAIN RESPONSE CONTENT */
    .response-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .response-text-large {
      color: #fff;
      font-size: 22px;
      line-height: 1.7;
      font-weight: 400;
      text-align: justify;
      margin-bottom: 30px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      hyphens: auto;
      word-break: break-word;
    }

    /* RESPONSE FOOTER */
    .response-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-wrap: wrap;
      gap: 15px;
    }

    .response-stats {
      display: flex;
      gap: 25px;
      align-items: center;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }

    .stat-value {
      color: rgba(255, 140, 60, 0.9);
      font-weight: 600;
    }

    .timestamp-large {
      color: rgba(255, 255, 255, 0.5);
      font-size: 13px;
      font-style: italic;
    }

    /* INTERACTION HINTS */
    .interaction-hints {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.4);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .response-poster:hover .interaction-hints {
      opacity: 1;
    }

    .hint-item {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(255, 255, 255, 0.05);
      padding: 4px 8px;
      border-radius: 8px;
      backdrop-filter: blur(5px);
    }

    /* NAVIGATION */
    .navigation-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-arrow {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 140, 60, 0.1);
      border: 2px solid rgba(255, 140, 60, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255, 140, 60, 0.8);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      font-weight: bold;
    }

    .nav-arrow:hover {
      background: rgba(255, 140, 60, 0.2);
      border-color: rgba(255, 140, 60, 0.6);
      color: #fff;
      transform: scale(1.1);
    }

    .nav-arrow.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    .navigation-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .current-response {
      font-size: 18px;
      font-weight: 600;
      color: rgba(255, 140, 60, 0.9);
    }

    .navigation-dots {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .nav-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-dot.active {
      background: rgba(255, 140, 60, 0.9);
      transform: scale(1.5);
      box-shadow: 0 0 10px rgba(255, 140, 60, 0.4);
    }

    .nav-dot:hover {
      background: rgba(255, 140, 60, 0.6);
      transform: scale(1.2);
    }

    .no-responses {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 70vh;
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
    }

    .no-responses-icon {
      font-size: 64px;
      margin-bottom: 30px;
      opacity: 0.5;
    }

    .no-responses h3 {
      font-size: 24px;
      margin-bottom: 15px;
    }

    .footer {
      margin-top: 30px;
      background: rgba(64, 64, 64, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .nav-button {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.08);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.7);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      text-decoration: none;
    }

    .nav-button:hover {
      background: rgba(255, 140, 60, 0.2);
      color: #fff;
      transform: scale(1.1);
    }

    /* Animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(var(--rotate)); opacity: var(--base-opacity); }
      33% { transform: translateY(-8px) rotate(calc(var(--rotate) + 1deg)); opacity: calc(var(--base-opacity) * 1.2); }
      66% { transform: translateY(-4px) rotate(calc(var(--rotate) - 0.5deg)); opacity: calc(var(--base-opacity) * 0.8); }
    }

    @keyframes pulse {
      0%, 100% { opacity: var(--base-opacity); transform: scale(1) rotate(var(--rotate)); }
      50% { opacity: calc(var(--base-opacity) * 1.5); transform: scale(1.02) rotate(var(--rotate)); }
    }

    @keyframes drift {
      0%, 100% { transform: translateX(0px) translateY(0px) rotate(var(--rotate)); }
      25% { transform: translateX(3px) translateY(-5px) rotate(calc(var(--rotate) + 1deg)); }
      50% { transform: translateX(-2px) translateY(-8px) rotate(calc(var(--rotate) - 0.5deg)); }
      75% { transform: translateX(4px) translateY(-3px) rotate(calc(var(--rotate) + 0.8deg)); }
    }

    .curve1 { --base-opacity: 0.4; --rotate: 8deg; animation: float 8s ease-in-out infinite; }
    .curve2 { --base-opacity: 0.3; --rotate: -5deg; animation: float 10s ease-in-out infinite reverse; }
    .curve3 { --base-opacity: 0.25; --rotate: 12deg; animation: drift 6s ease-in-out infinite; }
    .curve4 { --base-opacity: 0.2; --rotate: -10deg; animation: pulse 12s ease-in-out infinite; }
    .curve5 { --base-opacity: 0.35; --rotate: 6deg; animation: float 9s ease-in-out infinite reverse; }
    .curve6 { --base-opacity: 0.15; --rotate: -15deg; animation: drift 15s ease-in-out infinite reverse; }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px 15px 15px;
      }
      
      .header {
        margin-bottom: 30px;
      }
      
      .header h1 {
        font-size: 28px;
      }
      
      .question-text {
        font-size: 18px;
      }
      
      .response-poster {
        padding: 25px;
        gap: 20px;
      }
      
      .student-header {
        gap: 15px;
      }
      
      .student-photo-large {
        width: 60px;
        height: 60px;
      }
      
      .student-name-large {
        font-size: 22px;
      }
      
      .response-text-large {
        font-size: 18px;
        line-height: 1.6;
      }
      
      .navigation-container {
        gap: 20px;
        margin-bottom: 20px;
      }
      
      .nav-arrow {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }
      
      .footer {
        margin-top: 20px;
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="background">
    <div class="curved-overlay">
      <div class="curve curve1"></div>
      <div class="curve curve2"></div>
      <div class="curve curve3"></div>
      <div class="curve curve4"></div>
      <div class="curve curve5"></div>
      <div class="curve curve6"></div>
    </div>
  </div>

  <div class="container">
    <header class="header">
      <h1>INTUITY</h1>
      <p>Live Responses - Full Display<br>By Majid Nashtai</p>
    </header>

    <div class="question-display">
      <div class="question-content">
        <div class="question-text" id="questionText">Loading question...</div>
        <div class="total-count" id="totalCount">Loading responses...</div>
      </div>
    </div>

    <div class="response-container" id="responseContainer">
      <div class="no-responses" id="noResponses">
        <div class="no-responses-icon">💭</div>
        <h3>No responses yet</h3>
        <div>Responses will appear here as students submit them</div>
      </div>
    </div>

    <div class="navigation-container">
      <div class="nav-arrow" id="prevArrow" onclick="navigateToResponse(currentIndex - 1)">‹</div>
      <div class="navigation-info">
        <div class="current-response" id="currentResponse">1 of 1</div>
        <div class="navigation-dots" id="navigationDots"></div>
      </div>
      <div class="nav-arrow" id="nextArrow" onclick="navigateToResponse(currentIndex + 1)">›</div>
    </div>

    <footer class="footer">
      <button class="nav-button" onclick="window.close()" title="Close">✕</button>
      <a href="../index.html" class="nav-button" title="Home">⌂</a>
      <button class="nav-button" onclick="goToAnalytics()" title="Back to Analytics">📊</button>
      <button class="nav-button" id="refreshBtn" title="Refresh">🔄</button>
    </footer>
  </div>

  <script>
    let currentQuestion = null;
    let responses = [];
    let currentIndex = 0;

    function loadData() {
      try {
        const questionData = localStorage.getItem('display_question');
        if (questionData) {
          currentQuestion = JSON.parse(questionData);
        }

        const responseSources = [
          'display_responses',
          'alm_student_responses', 
          'intuity_responses',
          'student_responses',
          'intuity_student_responses'
        ];

        for (const source of responseSources) {
          const responsesData = localStorage.getItem(source);
          if (responsesData) {
            try {
              const parsed = JSON.parse(responsesData);
              if (Array.isArray(parsed) && parsed.length > 0) {
                responses = parsed;
                console.log(`✅ Loaded ${responses.length} responses from ${source}`);
                break;
              }
            } catch (e) {
              console.warn(`Failed to parse ${source}:`, e);
            }
          }
        }

        return true;
      } catch (error) {
        console.error('Error loading data:', error);
        return false;
      }
    }

    function displayQuestion() {
      const questionText = document.getElementById('questionText');
      const totalCount = document.getElementById('totalCount');

      if (currentQuestion) {
        const questionStr = currentQuestion.questionText || currentQuestion.text || currentQuestion.question_text || 'Question';
        questionText.textContent = questionStr;
      } else {
        questionText.textContent = 'No question selected';
      }

      const count = responses.length;
      totalCount.textContent = `${count} response${count !== 1 ? 's' : ''}`;
    }

    function createResponseCard(response, index) {
      const card = document.createElement('div');
      card.className = 'response-card';
      card.id = `response-${index}`;

      const studentName = response.studentName || response.student_name || 'Anonymous';
      const answer = response.answer || 'No response text';
      const wordCount = response.wordCount || response.word_count || 0;
      const timestamp = formatTimestamp(response.timestamp || response.created_at || response.submitted_at);
      const photoUrl = response.photoUrl || response.photo_url || response.metadata?.photo_url;

      // Calculate reading time (average 200 words per minute)
      const readingTime = Math.max(1, Math.ceil(wordCount / 200));

      const photoHtml = photoUrl ? 
        `<img src="${photoUrl}" alt="${escapeHtml(studentName)}" class="student-photo-large" onerror="this.style.display='none'">` :
        `<div class="student-photo-large" style="background: linear-gradient(135deg, rgba(255,140,60,0.3), rgba(255,100,40,0.3)); display: flex; align-items: center; justify-content: center; font-size: 32px; color: rgba(255,140,60,0.8);">👤</div>`;

      card.innerHTML = `
        <div class="response-poster">
          <div class="student-header">
            ${photoHtml}
            <div class="student-info-large">
              <div class="student-name-large">${escapeHtml(studentName)}</div>
              <div class="student-meta">
                <div class="response-number">Response ${index + 1}</div>
                <div>${timestamp}</div>
                ${photoUrl ? '<div style="color: rgba(16, 185, 129, 0.8);">📸 Photo</div>' : ''}
              </div>
            </div>
          </div>
          
          <div class="response-content">
            <div class="response-text-large">${escapeHtml(answer)}</div>
          </div>
          
          <div class="response-footer">
            <div class="response-stats">
              <div class="stat-item">
                <span>📝</span>
                <span class="stat-value">${wordCount}</span>
                <span>words</span>
              </div>
              <div class="stat-item">
                <span>⏱</span>
                <span class="stat-value">${readingTime}</span>
                <span>min read</span>
              </div>
              <div class="stat-item">
                <span>📊</span>
                <span class="stat-value">${determineQuality(wordCount)}</span>
                <span>quality</span>
              </div>
            </div>
            <div class="timestamp-large">Submitted ${timestamp}</div>
          </div>
          
          <div class="interaction-hints">
            <div class="hint-item"><span>←→</span> Navigate</div>
            <div class="hint-item"><span>Space</span> Next</div>
            <div class="hint-item"><span>R</span> Refresh</div>
          </div>
        </div>
      `;

      return card;
    }

    function determineQuality(wordCount) {
      if (wordCount >= 25) return 'Excellent';
      if (wordCount >= 15) return 'Good';
      if (wordCount >= 8) return 'Fair';
      return 'Brief';
    }

    function displayResponses() {
      const container = document.getElementById('responseContainer');
      const noResponses = document.getElementById('noResponses');
      
      console.log('Displaying responses:', responses.length);
      
      if (responses.length === 0) {
        noResponses.style.display = 'flex';
        updateNavigation();
        return;
      }

      noResponses.style.display = 'none';

      // Sort responses by timestamp
      const sortedResponses = [...responses].sort((a, b) => {
        const timeA = new Date(a.timestamp || a.created_at || a.submitted_at || 0);
        const timeB = new Date(b.timestamp || b.created_at || b.submitted_at || 0);
        return timeB - timeA;
      });

      // Clear container
      container.innerHTML = '';

      // Create all cards
      sortedResponses.forEach((response, index) => {
        const card = createResponseCard(response, index);
        if (index === currentIndex) {
          card.classList.add('active');
        }
        container.appendChild(card);
      });

      updateNavigation();
    }

    function updateNavigation() {
      const prevArrow = document.getElementById('prevArrow');
      const nextArrow = document.getElementById('nextArrow');
      const currentResponseEl = document.getElementById('currentResponse');
      
      if (responses.length <= 1) {
        prevArrow.classList.add('disabled');
        nextArrow.classList.add('disabled');
        currentResponseEl.textContent = responses.length === 0 ? '0 of 0' : '1 of 1';
      } else {
        prevArrow.classList.toggle('disabled', currentIndex === 0);
        nextArrow.classList.toggle('disabled', currentIndex === responses.length - 1);
        currentResponseEl.textContent = `${currentIndex + 1} of ${responses.length}`;
      }

      createNavigationDots();
    }

    function createNavigationDots() {
      const dotsContainer = document.getElementById('navigationDots');
      dotsContainer.innerHTML = '';

      if (responses.length <= 1) return;

      // Show up to 10 dots
      const maxDots = Math.min(responses.length, 10);
      for (let i = 0; i < maxDots; i++) {
        const dot = document.createElement('div');
        dot.className = `nav-dot ${i === currentIndex ? 'active' : ''}`;
        dot.addEventListener('click', () => navigateToResponse(i));
        dot.title = `Response ${i + 1}`;
        dotsContainer.appendChild(dot);
      }

      // Add "more" indicator if there are more responses
      if (responses.length > 10) {
        const moreDot = document.createElement('div');
        moreDot.textContent = '…';
        moreDot.style.color = 'rgba(255, 140, 60, 0.6)';
        moreDot.style.fontSize = '14px';
        moreDot.style.width = 'auto';
        moreDot.style.padding = '0 5px';
        dotsContainer.appendChild(moreDot);
      }
    }

    function navigateToResponse(index) {
      if (index < 0 || index >= responses.length || index === currentIndex) {
        return;
      }

      console.log(`Navigating from ${currentIndex} to ${index}`);

      // Hide current card
      const currentCard = document.querySelector('.response-card.active');
      if (currentCard) {
        currentCard.classList.remove('active');
      }

      currentIndex = index;

      // Show new card
      setTimeout(() => {
        document.querySelectorAll('.response-card').forEach((card, i) => {
          if (i === currentIndex) {
            card.classList.add('active');
          } else {
            card.classList.remove('active');
          }
        });

        updateNavigation();
      }, 100);
    }

    function formatTimestamp(timestamp) {
      if (!timestamp) return 'Unknown time';
      
      try {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return 'Just now';
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        if (diffDays < 7) return `${diffDays}d ago`;
        
        return date.toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          hour: 'numeric',
          minute: '2-digit'
        });
      } catch (error) {
        return 'Unknown time';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function refreshData() {
      const refreshBtn = document.getElementById('refreshBtn');
      refreshBtn.style.animation = 'spin 1s linear infinite';

      if (loadData()) {
        displayQuestion();
        displayResponses();
        console.log('Data refreshed successfully');
      }

      setTimeout(() => {
        refreshBtn.style.animation = '';
      }, 1000);
    }

    function goToAnalytics() {
      window.location.href = '../visualisation/';
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (responses.length === 0) return;
      
      switch(e.key) {
        case 'ArrowLeft':
        case 'ArrowUp':
          e.preventDefault();
          navigateToResponse(currentIndex - 1);
          break;
        case 'ArrowRight':
        case 'ArrowDown':
        case ' ': // Spacebar
          e.preventDefault();
          navigateToResponse(currentIndex + 1);
          break;
        case 'Home':
          e.preventDefault();
          navigateToResponse(0);
          break;
        case 'End':
          e.preventDefault();
          navigateToResponse(responses.length - 1);
          break;
        case 'r':
        case 'R':
          e.preventDefault();
          refreshData();
          break;
      }
    });

    // Touch/swipe navigation
    let startX = null;
    document.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    document.addEventListener('touchend', (e) => {
      if (startX === null) return;
      
      const endX = e.changedTouches[0].clientX;
      const diffX = startX - endX;
      
      if (Math.abs(diffX) > 50) {
        if (diffX > 0) {
          navigateToResponse(currentIndex + 1);
        } else {
          navigateToResponse(currentIndex - 1);
        }
      }
      
      startX = null;
    });

    function startAutoRefresh() {
      setInterval(() => {
        const oldCount = responses.length;
        loadData();
        const newCount = responses.length;
        
        if (newCount !== oldCount) {
          displayQuestion();
          displayResponses();
        }
      }, 5000);
    }

    function init() {
      console.log('🚀 INTUITY Full Response Display initializing...');
      
      if (!loadData()) {
        // Demo data
        currentQuestion = { questionText: 'Demo Question: What would you like to learn today?' };
        responses = [
          {
            studentName: 'Emma Chen',
            answer: 'I\'d love to learn more about sustainable architecture and how buildings can work with nature rather than against it. The concept of biomimicry in design fascinates me - imagine buildings that breathe like organisms, use photosynthesis for energy, or adapt to weather patterns like living creatures. I think this could revolutionize how we approach urban planning and environmental conservation.',
            wordCount: 58,
            timestamp: new Date().toISOString(),
            photoUrl: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face'
          },
          {
            studentName: 'Marcus Johnson', 
            answer: 'Artificial intelligence fascinates me, especially how it can help solve climate change through better predictions and resource management. I want to understand machine learning algorithms that can analyze massive environmental datasets to predict weather patterns, optimize energy usage, and help cities become more efficient. The intersection of AI and sustainability seems like where the future lies.',
            wordCount: 52,
            timestamp: new Date(Date.now() - 120000).toISOString(),
            photoUrl: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face'
          },
          {
            studentName: 'Sophia Rodriguez',
            answer: 'I want to understand quantum computing better - the way it processes information simultaneously instead of sequentially seems revolutionary. The potential applications in cryptography, drug discovery, and financial modeling are incredible. I\'m particularly interested in how quantum computers might help us solve complex optimization problems that are currently impossible for classical computers to handle efficiently.',
            wordCount: 49,
            timestamp: new Date(Date.now() - 300000).toISOString(),
            photoUrl: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face'
          }
        ];
        console.log('Using demo data with', responses.length, 'responses');
      }

      displayQuestion();
      displayResponses();
      startAutoRefresh();

      document.getElementById('refreshBtn').addEventListener('click', refreshData);

      console.log('✅ INTUITY Full Response Display ready!');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', init);

    // Storage listener
    window.addEventListener('storage', (e) => {
      if (e.key === 'display_responses' || e.key === 'display_question') {
        refreshData();
      }
    });

    // Add refresh animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
